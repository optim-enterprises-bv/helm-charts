{{- if .Values.ui.enabled }}
{{/*
Secret for the management web UI.

DATABASE_URL          — SQLAlchemy connection string pointing at the MySQL primary.
SECRET_KEY            — Starlette SessionMiddleware signing key.
HTTPS_ONLY            — Set to "true" to enforce Secure cookies (recommended behind TLS ingress).
DATABUNKER_URL        — HTTP URL of the Databunker PII vault (in-cluster or external).
DATABUNKER_ROOT_TOKEN — Root API token for the Databunker vault.
*/}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "optimacs.ui.secretName" . }}
  labels:
    {{- include "optimacs.ui.labels" . | nindent 4 }}
type: Opaque
stringData:
  DATABASE_URL: "mysql+pymysql://{{ include "optimacs.mysql.user" . }}:{{ required "db.password is required" .Values.db.password }}@{{ include "optimacs.mysql.host" . }}/{{ include "optimacs.mysql.database" . }}"
  SECRET_KEY: {{ required "ui.secretKey is required when ui.enabled=true" .Values.ui.secretKey | quote }}
  HTTPS_ONLY: {{ if .Values.ui.ingress.tls }}"true"{{ else }}"false"{{ end }}
  DATABUNKER_URL: {{ include "optimacs.databunker.url" . | quote }}
  DATABUNKER_ROOT_TOKEN: {{ if .Values.databunker.enabled }}{{ required "databunker.rootToken is required when databunker.enabled=true" .Values.databunker.rootToken | quote }}{{ else }}{{ .Values.databunker.rootToken | default "" | quote }}{{ end }}
{{- end }}
